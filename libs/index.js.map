{"version":3,"sources":["../src/index.js"],"names":["seneca_options","config","si","act","args","resolve","reject","err","resp","ok","deserializeError","error","result","add","options","callback","done","length","bind","resultWithArgs","isThenable","then","response","catch","e","serializeError","uses","reduce","prev","curr","use","listenings","listen","clients","client","name","stack","message","errors","oe","Error"],"mappings":"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","file":"index.js","sourcesContent":["import seneca from 'seneca';\nimport Promise from 'bluebird';\n\nconst serializeError = (e)=>{\n  return {name:e.name,stack:e.stack,message:e.message,errors: e.errors};\n}\n\nconst deserializeError = (oe)=>{\n  const e = new Error(oe.message);\n  e.name = oe.name;\n  e.errors = oe.errors;\n  e.stack = oe.stack;\n  return e;\n}\n\nexport default function(seneca_options,config){\n  const si = seneca(seneca_options);\n\n  const act = (args) =>{\n    return new Promise((resolve,reject)=>{\n      si.act(args,function(err,resp){\n        if(err){ reject(err); return; }\n        else if(!resp.ok) reject(deserializeError(resp.error));\n        else resolve(resp.result);\n      });\n    });\n\n  }\n\n  const add = (options,callback)=>{\n    si.add(options,function(args,done){\n      try{\n        if(callback.length>=2){\n          callback.bind(si)(args,done);\n        }else{\n            const resultWithArgs = callback.bind(si)(args);\n            const isThenable = ('function' === typeof resultWithArgs.then);\n            if(isThenable){\n              resultWithArgs.then((response)=>{\n                done(null,{ok:true,result:response});\n              }).catch((e)=>{\n                done(null,{ok:false,error:serializeError(e)});\n              });\n            }else{\n              done(null,{ok:true,result:resultWithArgs});\n            }\n        }\n      }catch(e){\n        done(null,{ok:false,error:serializeError(e)});\n        return;\n      }\n    })\n  };\n\n  if(config && config.uses){\n    config.uses.reduce((prev,curr)=>{\n      return prev.use(curr);\n    },si);\n  }\n\n  if(config && config.listenings){\n    config.listenings.reduce((prev,curr)=>{\n      return prev.listen(curr);\n    },si);\n  }\n\n  if(config && config.clients){\n    config.clients.reduce((prev,curr)=>{\n      return prev.client(curr);\n    },si);\n  }\n\n  return {act,add,si};\n};"]}