{"version":3,"sources":["../src/seneca-wrapper.js"],"names":["serializeError","e","name","stack","message","errors","deserializeError","oe","Error","actGenerator","si","args","resolve","reject","act","err","resp","ok","error","result","addGenerator","options","callback","add","done","length","bind","resultWithArgs","isThenable","then","response","catch"],"mappings":";;;;;;;AAAA;;;;;;AAEA,IAAMA,iBAAiB,SAAjBA,cAAiB,CAACC,CAAD,EAAM;AAC3B,SAAO,EAACC,MAAMD,EAAEC,IAAT,EAAeC,OAAOF,EAAEE,KAAxB,EAA+BC,SAASH,EAAEG,OAA1C,EAAmDC,QAAQJ,EAAEI,MAA7D,EAAP;AACD,CAFD;;AAIA,IAAMC,mBAAmB,SAAnBA,gBAAmB,CAACC,EAAD,EAAO;AAC9B,MAAMN,IAAI,IAAIO,KAAJ,CAAUD,GAAGH,OAAb,CAAV;AACAH,IAAEC,IAAF,GAASK,GAAGL,IAAZ;AACAD,IAAEI,MAAF,GAAWE,GAAGF,MAAd;AACAJ,IAAEE,KAAF,GAAUI,GAAGJ,KAAb;AACA,SAAOF,CAAP;AACD,CAND;;AAQO,IAAMQ,sCAAe,SAAfA,YAAe,CAACC,EAAD,EAAQ;AAClC,SAAO,UAACC,IAAD,EAAU;AACf,WAAO,uBAAY,UAACC,OAAD,EAAUC,MAAV,EAAoB;AACrCH,SAAGI,GAAH,CAAOH,IAAP,EAAa,UAAUI,GAAV,EAAeC,IAAf,EAAqB;AAChC,YAAID,GAAJ,EAAS;AACPF,iBAAOE,GAAP;AACA;AACD,SAHD,MAIK,IAAI,CAACC,KAAKC,EAAV,EAAcJ,OAAOP,iBAAiBU,KAAKE,KAAtB,CAAP,EAAd,KACAN,QAAQI,KAAKG,MAAb;AACN,OAPD;AAQD,KATM,CAAP;AAUD,GAXD;AAYD,CAbM;;AAeA,IAAMC,sCAAe,SAAfA,YAAe,CAACV,EAAD,EAAQ;AAClC,SAAO,UAACW,OAAD,EAAUC,QAAV,EAAsB;AAC3BZ,OAAGa,GAAH,CAAOF,OAAP,EAAgB,UAAUV,IAAV,EAAgBa,IAAhB,EAAsB;AACpC,UAAI;AACF,YAAIF,SAASG,MAAT,IAAmB,CAAvB,EAA0B;AACxBH,mBAASI,IAAT,CAAchB,EAAd,EAAkBC,IAAlB,EAAwBa,IAAxB;AACD,SAFD,MAEO;AACL,cAAMG,iBAAiBL,SAASI,IAAT,CAAchB,EAAd,EAAkBC,IAAlB,CAAvB;AACA,cAAMiB,aAAc,eAAe,OAAOD,eAAeE,IAAzD;AACA,cAAID,UAAJ,EAAgB;AACdD,2BAAeE,IAAf,CAAoB,UAACC,QAAD,EAAa;AAC/BN,mBAAK,IAAL,EAAW,EAACP,IAAI,IAAL,EAAWE,QAAQW,QAAnB,EAAX;AACD,aAFD,EAEGC,KAFH,CAES,UAAC9B,CAAD,EAAM;AACbuB,mBAAK,IAAL,EAAW,EAACP,IAAI,KAAL,EAAYC,OAAOlB,eAAeC,CAAf,CAAnB,EAAX;AACD,aAJD;AAKD,WAND,MAMO;AACLuB,iBAAK,IAAL,EAAW,EAACP,IAAI,IAAL,EAAWE,QAAQQ,cAAnB,EAAX;AACD;AACF;AACF,OAhBD,CAgBE,OAAO1B,CAAP,EAAU;AACVuB,aAAK,IAAL,EAAW,EAACP,IAAI,KAAL,EAAYC,OAAOlB,eAAeC,CAAf,CAAnB,EAAX;AACA;AACD;AACF,KArBD;AAsBD,GAvBD;AAwBD,CAzBM","file":"seneca-wrapper.js","sourcesContent":["import Promise from 'bluebird';\n\nconst serializeError = (e)=> {\n  return {name: e.name, stack: e.stack, message: e.message, errors: e.errors};\n}\n\nconst deserializeError = (oe)=> {\n  const e = new Error(oe.message);\n  e.name = oe.name;\n  e.errors = oe.errors;\n  e.stack = oe.stack;\n  return e;\n}\n\nexport const actGenerator = (si) => {\n  return (args) => {\n    return new Promise((resolve, reject)=> {\n      si.act(args, function (err, resp) {\n        if (err) {\n          reject(err);\n          return;\n        }\n        else if (!resp.ok) reject(deserializeError(resp.error));\n        else resolve(resp.result);\n      });\n    });\n  }\n}\n\nexport const addGenerator = (si) => {\n  return (options, callback)=> {\n    si.add(options, function (args, done) {\n      try {\n        if (callback.length >= 2) {\n          callback.bind(si)(args, done);\n        } else {\n          const resultWithArgs = callback.bind(si)(args);\n          const isThenable = ('function' === typeof resultWithArgs.then);\n          if (isThenable) {\n            resultWithArgs.then((response)=> {\n              done(null, {ok: true, result: response});\n            }).catch((e)=> {\n              done(null, {ok: false, error: serializeError(e)});\n            });\n          } else {\n            done(null, {ok: true, result: resultWithArgs});\n          }\n        }\n      } catch (e) {\n        done(null, {ok: false, error: serializeError(e)});\n        return;\n      }\n    })\n  }\n}"]}